name: CI
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  

    
    
jobs:
 
  build-with-upload-artifact:
    runs-on:   ubuntu-latest
    
  
    steps:
        

    
    - uses:  actions/checkout@v3
    
    
   

    - name: Set up JDK 
      uses: actions/setup-java@v3
      with:
          java-version: 11.0.16
          distribution: 'adopt'


    - name: Backup JAVA_HOME
      id: java-home
      run: echo "::set-output name=path::$JAVA_HOME"
    
    
      

    - name: Android JDK install and aab build 
      env:
        PASSWORDB64: ${{ secrets.PASSWORDB64 }}
        KEYSTORE_JKS: ${{ secrets.KEYSTORE_JKS }}
        
      run: |
             sudo apt-get install libc6-dev-i386 lib32z1 openjdk-11-jdk
                     
             pwd
             ls -l
                  
             printf 'B395b39595\nB395b39595\nA\nB\nC\nD\nE\nUA\nYes\n' | keytool -genkeypair -validity 365 -keystore signing_key.jks -alias $ALIAS -keyalg RSA -keysize 2048 
             pwd
             ls -l
             openssl base64 < /home/runner/work/android-java-terminal/android-java-terminal/signing_key.jks | tr -d '\n' | tee signing_key.jks.base64.txt
             pwd
             ls -l
             cat signing_key.jks
             cp signing_key.jks /home/runner/work/android-java-terminal/android-java-terminal/app/build/outputs/apk/release/
             
             
             
             
             
             
             
             
             
             
             
             
             
             cd /home/runner/work/android-java-terminal/android-java-terminal/
             chmod +x build.sh
             ./build.sh
                              
                    
             

            
                           
           
    - name: Upload APK
     
      uses: actions/upload-artifact@v2
      with:
          name: apk file with signing
          path: /home/runner/work/android-java-terminal/android-java-terminal/app/build/outputs/apk/release/hello.apk   
           
     
   
