name: CI
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
    


    
    
jobs:
 
  build-with-upload-artifact:
    runs-on: ubuntu-latest
      
    steps:
        

    
    - uses: actions/checkout@v3

    - name: Set up JDK 1.8
      uses: actions/setup-java@v3
      with:
          java-version: 18.0.2+9
          distribution: 'adopt'

    - name: Android JDK install and apk build
      run: |
             sudo apt-get install libc6-dev-i386 lib32z1 openjdk-8-jdk
             pwd
             ls -l 
             chmod +x build.sh
             ./build.sh
        
        
    - name: Upload APK
     
      uses: actions/upload-artifact@v2
      with:
           name: hello.unaligned.apk
           path: /home/runner/work/android-java-terminal/android-java-terminal/bin      
          
  
  
  
  
    - name: Archive site content
      uses: thedoctor0/zip-release@master
      with:
            filename: test.zip     
            exclusions: ' *.cpp / *.c /*.yml  / .git'  
               
    - name: Create new release
      id: create-new-release
      uses: actions/create-release@latest
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
          tag_name: ${{ github.run_number }}
          release_name: Release ${{ github.run_number }}
          body: |
                run_number
          draft: false
          prerelease: false     

    - name: Upload release asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:  
         upload_url:   ${{ steps.create-new-release.outputs.upload_url }}
         asset_path: ./test.zip
         asset_name: test-v${{ github.run_number }}.zip
         asset_content_type: application/zip  
  
  
  
  
  
  
  
  
  
  
  
  
   #  - name: mkdir app/....
    #   run: |
              # mkdir  /home/runner/work/android-java-terminal/android-java-terminal/app/build/outputs/apk/release
     
     
     
     
     
  #  - name: Sign APK
   #    id: sign_apk
 #      uses: r0adkll/sign-android-release@v1
  #     with:
    #       releaseDirectory: /home/runner/work/android-java-terminal/android-java-terminal/bin
      #     signingKeyBase64: ${{ secrets.SIGNINGKEYBASE64 }}
        #   alias: ${{ secrets.ALIAS }}
          # keyStorePassword: ${{ secrets.KEYSTOREPASSWORD }}
           #keyPassword: ${{ secrets.KEYPASSWORD }}
             
             
             
             
             
             
             
